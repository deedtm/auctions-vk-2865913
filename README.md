# Гайд по установке бота


## 1. Установка бота на сервер

В терминал вставляем следующие команды:
```bash
git clone https://github.com/deedtm/auctions-vk-2865913.git
cd auctions-vk-2865913
```
Первой командой в изначальной директории создается директория `auctions-vk-2865913`, и в нее скачивается исходник бота. Второй командой мы переходим в эту директорию

> [!NOTE]
> Исходный код бота требует установки зависимостей, использующихся, например, для использования VK API, управлением базы данных и т.д. Из-за наличия зависимостей, нужно также создать виртуальную среду для Python, чтобы бот использовал обособленную от глобальной копию Python. Нужно это для того, чтобы в дальнейшем, при установке новых Python-скриптов, не возникало конфликтов с установленными прежне зависимостями.

В терминал вставляем следующие команды:
```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```
Сначала мы создаем виртуальную среду — директория .venv в директории бота. Далее мы активируем (переходим) в эту виртуальную среду и затем устанавливаем зависимости из файла `requirements.txt`.

> [!NOTE]
> После выполнения данных команд в терминале в начале последней строки, откуда вы вводите команды, должно появиться `(.venv)`. Это означает, что виртуальная среда активирована.

> [!TIP]
> Для деактивации виртуальной среды (выхода из нее) введите в терминал: `deactivate`

## 2. Получение токенов и настройка групп

### VK

Для получения **токенов группы** перейдите в раздел **Управление** со страницы вашей группы. Далее: **Дополнительно** >  **Работа с API**. С помощью кнопки **Создать ключ**, создаете токен с правами доступа: *управление*, *сообщения*, *документы*, *стена*. <br>
Такие действия необходимо проделать с каждой группой, где будет размещен бот

Для получения **токена пользователя** переходим по ссылке [vkhost.github.io](vkhost.github.io). Переходим в настройки, выбираем **Пользователь**, ID приложения **не меняем**. Снимаем все права и выбираем: *стена*, *доступ в любое время*, *группы*. Нажимаем **Получить**, нас перекидывает на страницу с просьбой разрешить доступ к аккаунту. Разрешаем и далее из адресной строки копируем и сохраняем последовательность символов от `access_token=` до `&expires_in`, **но access_token= и &expires_in не копируем**. Это и есть наш токен пользователя


### Терминал из Т-Банка

Для терминала необходимо получить его токен (значение поля **Терминал**) и пароль, из раздела **Интернет-эквайринг** с сайта **Т-Бизнес**. 

## 3. Настройка бота

> [!NOTE]
> Для настройки бота используется два файла: `config.ini` и `.env`. Первый файл предназначен для общих настроек, например, общий лимит постов в группах или префиксы для команд. Второй же файл содержит конфиденциальную информацию, как, например, токены групп или токен терминала от T-API.

### config.ini

В файле `config.ini` есть комментарии, которые подробно описывают каждое из полей, поэтому здесь будет затронут только синтаксис .ini файлов:
```ini
[раздел]
ключ1 = значение1
ключ2=значение2
ключ3 =значение3
ключ4= значение4
; комментарий
```
Внутри квадратных скобках — названия разделов, они предназначены только для разделения полей.
Все пары ключ=значение — это параметры, и в целом, не важно, как много пробелов будет перед и после символа `=`.
Символом `;` помечаются комментарии — строки, игнорирующиеся при получении данных из .ini файла, и предназначенных только для разъяснений при читке файла.

### .env

Файл `.env` в исходном коде отсутствует, и для его создания и установки данных нужно использовать файл `env_manager.py`.
В терминал вставляем (предварительно проверьте, что виртуальная среда активирована):
```bash
python3 env_manager.py
```
Далее выбираем `Полная установка` > `Полная установка окружения` и вводим значения (здесь понадобятся значения, полученные в п. 2), которые просит скрипт.

## 4. Запуск

Для запуска бота можно прописать в терминале, будучи в директории бота и предварительно удостоверившись, что виртуальная среда активирована:
```bash
python3 main.py
```

Но лучше использовать скрипт `start.sh`. Этот скрипт автоматически обновит код, вытянув его из гитхаба; активирует виртуальную среду; установит новые зависимости (если появились); и запустит бота.

**Запуск через скрипт:**
```bash
./start.sh
```
> [!IMPORTANT]
> При первом запуске сначала введите команду `chmod +x ./start.sh`, и только затем `./start.sh`. 
